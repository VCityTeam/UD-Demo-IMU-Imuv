os: linux
dist: focal
language: generic
services:
  - docker

env:
  - DOCKER_COMPOSE_VERSION=2.16.0
  
before_install:
  - docker --version
  - docker-compose --version
  # CLEAN ME - sudo apt-get update
  # CLEAN ME - sudo apt-get -y install openssl
  # CLEAN ME - openssl version
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - cat docker-compose
  - sudo mv docker-compose /usr/local/bin
  - docker --version
  - docker-compose --version

jobs:
  include:
    - stage: Building and running imuv container
      script:
        - cp env-default .env
        - ldd /usr/lib/git-core/git-remote-https
        - ldd /lib/x86_64-linux-gnu/libcrypto.so.1.1
        - /usr/lib/git-core/git-remote-https --version
        - /usr/lib/git-core/git-remote-https -v
        - /usr/lib/git-core/git-remote-https --help
        # CLEAN ME - /usr/lib/git-core/git-remote-https https://github.com/VCityTeam/UD-Imuv-docker.git
        - mkdir wbo-boards
        - sudo chown -R 1000:1000 wbo-boards
        - docker-compose build
        - docker-compose up -d
        # - curl -X POST -H "X-Parse-Application-Id: my_parse_app_id" -H "Content-Type: application/json" -d '{"score":1337,"playerName":"John Doe","cheatMode":false}' http://localhost:1337/parse/classes/GameScore
        # - curl -X GET -H "X-Parse-Application-Id: my_parse_app_id" http://localhost:1337/parse/classes/GameScore/8A0YN6GkJ7
        - travis_wait 2
        - docker-compose down
